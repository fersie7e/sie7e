{% extends 'security/layoutmain.html' %}
{% load static %}

{% block body %} 
    <div class="row h-100">
        <!--Nav map-->  
        <div class="row text-start mt-2">
            {% if editshift.invoiced %}
                <p><a href="{% url 'invoicefilter' %}">Invoices</a> > <a href="{% url 'invoicedetail' editshift.invoice_num %}">filter</a> > details</p>
            {% else %}
                <p><a href="{% url 'index' %}">Inicio</a> > <a href="{% url 'filtershift' editshift.date %}">filter</a> > set</p>
            {% endif %}
        </div>

        <!--Header-->
        <div class="masthead1 p-4 my-3">
            <div class="d-flex flex-column header">
                <h1 class="display-4 fw-bold text-body-emphasis">Update shift</h1>
                <h1> {{editshift.venue}} - {{editshift.date}}</h1>
                <i class="fa fa-id-card-o fa-2x mt-3 mb-2" aria-hidden="true"></i>
                <h5>{{editshift.shift_provider.name}}</h5>
            </div>
        </div>

        <div class="d-flex text-start justify-content-center">
            {% if not service_selected %}
                <form action="{% url 'setservice' editshift.id %}" method="post" style="width: 18rem;">
                    {% csrf_token %}
                    <div class="row form-group">
                        <div class="col-10">
                            <label for="service">Choose the service to provide</label>
                            <select class="form-select mb-3" name="service">
                                {% for service in services %}
                                    <option value="{{service.id}}">{{service.name}} : {{service.servicefee}}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-2">
                            <button type="submit" class="btn btn-primary mt-4">Set</button>
                        </div>
                    </div>
                </form>
            {% endif %}
        </div>

        
            {% if service_selected %}
                {% if not editshift.invoiced %}
                <!--Info section-->
                    <div class="info d-sm-flex bg-black text-white text-start justify-content-center p-5">
                        <div class="d-flex mx-4">
                            <form action="{% url 'addemployee' editshift.id %}" method="post" style="width: 18rem;">
                                {% csrf_token %}
                                <label for="employee">Add to the shift</label>
                                <select class="form-select mb-3" name="employee">
                                    {% for employee in not_working %}
                                        <option value="{{employee.id}}">{{employee.first_name}} {{employee.last_name}}</option>
                                    {% endfor %}
                                </select>
                                {% if not_working  %}
                                    <button type="submit" class="btn btn-primary mt-4">Add</button>
                                {% else %}
                                    <button type="submit" class="btn btn-primary mt-4" disabled>Add</button>
                                {% endif %}
                            </form>
                        </div>
                        <div class="d-flex flex-column  mx-4 px-4">
                            <p class="fs-6 lh-1 "><span class="fw-bold">Service: </span> {{editshift.service_provided.name}}</p>
                            <p class="fs-6 lh-1"><span class="fw-bold">Fee: </span>{{editshift.service_provided.servicefee.fee}}</p>
                        </div>    
                    </div>
                {% endif %}

                <!--Result divider-->
                <table class="table">
                    <tbody>
                    <tr>
                        <td scope="col" class="text-start">Employees working: {{num_emp}}</td>
                    </tr>
                    </tbody>
                </table>

                <!--Results-->
                <div class="d-flex flex-wrap justify-content-center">
                    {% for employee in working %}
                    <div class="border-start border-2 p-3 m-2" style="width: 18rem;">
                        <div class="card-body text-start">
                            <h5 class="card-title">{{employee.first_name}} {{employee.last_name}}</h5>
                            {% if shift.invoiced %}
                                <h3>INVOICED</h3>
                            {% else %}
                                <a href="{% url 'deleteemployeeshift' editshift.id employee.id %}" class="btn btn-primary">Delete</a>
                            {% endif%}
                        </div>
                    </div>
                {% endfor %}
                </div>
            {% endif%}
    </div>
{% endblock %}
